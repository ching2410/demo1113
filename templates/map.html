<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æˆ‘çš„åœ°åœ–æ”¶è—</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <h1>ğŸ—ºï¸ {{ current_user.username if current_user.is_authenticated else "è¨ªå®¢" }} çš„åœ°åœ–æ”¶è—</h1>
  <a href="{{ url_for('index') }}">è¿”å›æ¸…å–®</a>
  <div id="map" style="height:600px; margin-top:10px;"></div>

  <script>
    // å»ºç«‹åœ°åœ–
    var map = L.map('map').setView([23.5, 121], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // å–å¾—æ™¯é»è³‡æ–™
    var spots = {{ spots|tojson | safe }} || [];

    spots.forEach(function(s) {
      // åªå»ºç«‹æœ‰ç¶“ç·¯åº¦çš„æ¨™è¨˜
      var lat = parseFloat(s.lat);
      var lng = parseFloat(s.lng);
      if (!isNaN(lat) && !isNaN(lng)) {
        L.marker([lat, lng])
          .addTo(map)
          .bindPopup(
            `<b>${s.name || ''}</b><br>
             ${s.city || ''}<br>
             ${s.comment || ''}`
          );
      }
    });
  </script>
</body>
</html>
